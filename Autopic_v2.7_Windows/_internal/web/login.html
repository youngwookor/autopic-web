<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autopic - ë¡œê·¸ì¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        * { font-family: 'Inter', 'Malgun Gothic', sans-serif; box-sizing: border-box; margin: 0; padding: 0; }
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60%, 100% { content: '...'; } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        .animate-fade-out { animation: fadeOut 0.3s ease-out forwards; }
        .animate-pulse-slow { animation: pulse 2s ease-in-out infinite; }
        .animate-spin { animation: spin 1s linear infinite; }
        .loading-dots::after { content: ''; animation: dots 1.5s infinite; }
        .input-focus:focus { box-shadow: 0 0 0 3px rgba(163, 230, 53, 0.3); }
        
        /* ë¡œë”© í™”ë©´ - ì „ì²´ í™”ë©´ ì¤‘ì•™ */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #18181b 0%, #27272a 50%, #18181b 100%);
            z-index: 9999;
        }
        
        /* ë¡œê·¸ì¸ í™”ë©´ */
        #loginContainer {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            background: linear-gradient(135deg, #18181b 0%, #27272a 50%, #18181b 100%);
        }
    </style>
</head>
<body>

    <!-- ğŸ”„ ë¡œë”© í™”ë©´ (ì´ˆê¸° í‘œì‹œ) -->
    <div id="loadingScreen">
        <div style="text-align: center;">
            <!-- ë¡œê³  -->
            <div style="display: inline-flex; align-items: center; justify-content: center; width: 96px; height: 96px; background: #27272a; border-radius: 24px; margin-bottom: 32px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); border: 1px solid #3f3f46;" class="animate-pulse-slow">
                <svg viewBox="0 0 24 24" style="width: 48px; height: 48px; color: #a3e635;" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/>
                    <circle cx="12" cy="13" r="3"/>
                </svg>
            </div>
            
            <!-- íƒ€ì´í‹€ -->
            <h1 style="font-size: 36px; font-weight: 900; color: #a3e635; letter-spacing: -1px; margin-bottom: 12px;">AUTOPIC</h1>
            
            <!-- ë¡œë”© ë©”ì‹œì§€ -->
            <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 24px;">
                <svg style="width: 20px; height: 20px; color: #a3e635;" class="animate-spin" fill="none" viewBox="0 0 24 24">
                    <circle style="opacity: 0.25;" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path style="opacity: 0.75;" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                </svg>
                <p style="color: #a1a1aa; font-size: 14px;" class="loading-dots">í”„ë¡œê·¸ë¨ ì„¸íŒ…ì¤‘ ì…ë‹ˆë‹¤</p>
            </div>
            
            <!-- ì§„í–‰ ë°” -->
            <div style="width: 256px; height: 4px; background: #3f3f46; border-radius: 9999px; overflow: hidden; margin: 0 auto;">
                <div id="loadingProgress" style="height: 100%; background: #a3e635; border-radius: 9999px; transition: all 0.3s; width: 0%;"></div>
            </div>
            
            <!-- ìƒíƒœ ë©”ì‹œì§€ -->
            <p id="loadingStatus" style="color: #71717a; font-size: 12px; margin-top: 16px;">ì´ˆê¸°í™” ì¤‘...</p>
        </div>
    </div>

    <!-- ğŸ“ ë¡œê·¸ì¸ í¼ (ë¡œë”© í›„ í‘œì‹œ) -->
    <div id="loginContainer" style="display: none;">
        <div id="loginScreen" style="width: 100%; max-width: 448px;">
            <!-- ë¡œê³  ì˜ì—­ -->
            <div style="text-align: center; margin-bottom: 32px;">
                <div style="display: inline-flex; align-items: center; justify-content: center; width: 80px; height: 80px; background: #27272a; border-radius: 24px; margin-bottom: 24px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); border: 1px solid #3f3f46;">
                    <svg viewBox="0 0 24 24" style="width: 40px; height: 40px; color: #a3e635;" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/>
                        <circle cx="12" cy="13" r="3"/>
                    </svg>
                </div>
                <h1 style="font-size: 30px; font-weight: 900; color: white; letter-spacing: -1px; margin-bottom: 8px;">Autopic</h1>
                <p style="color: #a1a1aa; font-size: 14px;">AI ìƒí’ˆ ì´ë¯¸ì§€ ìë™ ìƒì„±</p>
            </div>

            <!-- ë¡œê·¸ì¸ ì¹´ë“œ -->
            <div style="background: #18181b; border-radius: 24px; padding: 32px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); border: 1px solid #27272a;" class="animate-fade-in">
                <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
                <div id="errorMessage" style="display: none; margin-bottom: 24px; padding: 16px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px;">
                    <p style="color: #f87171; font-size: 14px; font-weight: 500; text-align: center;" id="errorText"></p>
                </div>

                <!-- API í‚¤ ì…ë ¥ -->
                <div style="margin-bottom: 24px;">
                    <label style="display: block; font-size: 12px; font-weight: 700; color: #a1a1aa; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 12px;">API í‚¤</label>
                    <div style="position: relative;">
                        <input 
                            type="password" 
                            id="apiKeyInput" 
                            class="input-focus"
                            style="width: 100%; background: #27272a; border: 2px solid #3f3f46; border-radius: 12px; padding: 16px; color: white; font-size: 14px; outline: none; transition: all 0.2s;"
                            placeholder="ap_xxxx... í˜•ì‹ì˜ API í‚¤ ì…ë ¥"
                            autocomplete="off"
                            onfocus="this.style.borderColor='#a3e635'"
                            onblur="this.style.borderColor='#3f3f46'"
                        >
                        <button 
                            onclick="toggleKeyVisibility()" 
                            style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: #71717a; background: none; border: none; cursor: pointer; padding: 4px;"
                        >
                            <svg id="eyeIcon" style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                            </svg>
                            <svg id="eyeOffIcon" style="width: 20px; height: 20px; display: none;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- ë¡œê·¸ì¸ ë²„íŠ¼ -->
                <button 
                    onclick="login()" 
                    id="loginBtn"
                    style="width: 100%; padding: 16px; background: #a3e635; color: #18181b; border-radius: 12px; font-weight: 900; font-size: 14px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s;"
                    onmouseover="this.style.background='#bef264'"
                    onmouseout="this.style.background='#a3e635'"
                >
                    <span id="loginBtnIcon">ğŸ”—</span>
                    <span id="loginBtnText">ì—°ë™í•˜ê¸°</span>
                    <div id="loginBtnLoading" style="display: none;">
                        <svg style="width: 20px; height: 20px;" class="animate-spin" fill="none" viewBox="0 0 24 24">
                            <circle style="opacity: 0.25;" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path style="opacity: 0.75;" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                        </svg>
                    </div>
                </button>

                <!-- êµ¬ë¶„ì„  -->
                <div style="display: flex; align-items: center; margin: 24px 0;">
                    <div style="flex: 1; height: 1px; background: #3f3f46;"></div>
                    <span style="padding: 0 16px; font-size: 12px; color: #71717a;">API í‚¤ê°€ ì—†ìœ¼ì‹ ê°€ìš”?</span>
                    <div style="flex: 1; height: 1px; background: #3f3f46;"></div>
                </div>

                <!-- ë°œê¸‰ ì•ˆë‚´ -->
                <div style="background: rgba(39, 39, 42, 0.5); border-radius: 12px; padding: 20px; border: 1px solid rgba(63, 63, 70, 0.5);">
                    <h3 style="font-weight: 700; color: white; font-size: 14px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <span style="color: #a3e635;">ğŸ’¡</span> API í‚¤ ë°œê¸‰ ë°©ë²•
                    </h3>
                    <ol style="list-style: none; padding: 0; margin: 0;">
                        <li style="display: flex; align-items: flex-start; gap: 8px; font-size: 14px; color: #a1a1aa; margin-bottom: 8px;">
                            <span style="width: 20px; height: 20px; background: #3f3f46; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #d4d4d8; flex-shrink: 0; margin-top: 2px;">1</span>
                            <span><a href="https://autopic.app" target="_blank" style="color: #a3e635; text-decoration: none; font-weight: 500;">autopic.app</a> ì ‘ì†</span>
                        </li>
                        <li style="display: flex; align-items: flex-start; gap: 8px; font-size: 14px; color: #a1a1aa; margin-bottom: 8px;">
                            <span style="width: 20px; height: 20px; background: #3f3f46; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #d4d4d8; flex-shrink: 0; margin-top: 2px;">2</span>
                            <span>íšŒì›ê°€ì… í›„ í¬ë ˆë”§ ì¶©ì „</span>
                        </li>
                        <li style="display: flex; align-items: flex-start; gap: 8px; font-size: 14px; color: #a1a1aa; margin-bottom: 8px;">
                            <span style="width: 20px; height: 20px; background: #3f3f46; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #d4d4d8; flex-shrink: 0; margin-top: 2px;">3</span>
                            <span>ë§ˆì´í˜ì´ì§€ â†’ API í‚¤ ê´€ë¦¬</span>
                        </li>
                        <li style="display: flex; align-items: flex-start; gap: 8px; font-size: 14px; color: #a1a1aa;">
                            <span style="width: 20px; height: 20px; background: #3f3f46; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #d4d4d8; flex-shrink: 0; margin-top: 2px;">4</span>
                            <span>"ìƒˆ API í‚¤ ìƒì„±" í´ë¦­ í›„ ë³µì‚¬</span>
                        </li>
                    </ol>
                </div>
            </div>

            <!-- í‘¸í„° -->
            <p style="text-align: center; color: #52525b; font-size: 12px; margin-top: 24px;">
                Autopic Desktop v2.7 Â· Powered by AI
            </p>
        </div>
    </div>

    <script>
        let isKeyVisible = false;
        let pywebviewReady = false;

        // ë¡œë”© ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateLoadingStatus(percent, message) {
            document.getElementById('loadingProgress').style.width = percent + '%';
            document.getElementById('loadingStatus').textContent = message;
        }

        // ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê³  ë¡œê·¸ì¸ í¼ í‘œì‹œ
        function showLoginScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            const loginContainer = document.getElementById('loginContainer');
            
            loadingScreen.classList.add('animate-fade-out');
            setTimeout(() => {
                loadingScreen.style.display = 'none';
                loginContainer.style.display = 'flex';
                document.getElementById('apiKeyInput').focus();
            }, 300);
        }

        // ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
        function goToMainScreen(credits, keyName) {
            const params = new URLSearchParams();
            params.set('credits', credits || 0);
            params.set('keyName', keyName || '');
            params.set('loggedIn', 'true');
            window.location.href = 'index.html?' + params.toString();
        }

        // pywebview API ëŒ€ê¸° ë° ì´ˆê¸°í™”
        async function initializeApp() {
            updateLoadingStatus(10, 'API ì—°ê²° ëŒ€ê¸° ì¤‘...');
            
            // pywebview APIê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸° (ìµœëŒ€ 10ì´ˆ)
            let attempts = 0;
            while (!window.pywebview || !window.pywebview.api) {
                await new Promise(resolve => setTimeout(resolve, 100));
                attempts++;
                if (attempts > 100) {
                    updateLoadingStatus(100, 'ì—°ê²° ì‹¤íŒ¨ - ì¬ì‹œì‘í•´ì£¼ì„¸ìš”');
                    showLoginScreen();
                    return;
                }
                updateLoadingStatus(10 + Math.min(attempts, 30), 'API ì—°ê²° ì¤‘...');
            }
            
            pywebviewReady = true;
            updateLoadingStatus(50, 'ì €ì¥ëœ ì„¤ì • í™•ì¸ ì¤‘...');
            
            try {
                // ì €ì¥ëœ API í‚¤ í™•ì¸
                const result = await pywebview.api.check_login_status();
                updateLoadingStatus(80, 'ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì¤‘...');
                
                await new Promise(resolve => setTimeout(resolve, 300));
                
                if (result && result.logged_in) {
                    // ì´ë¯¸ ë¡œê·¸ì¸ë¨ - ë©”ì¸ í™”ë©´ìœ¼ë¡œ
                    updateLoadingStatus(100, 'ë¡œê·¸ì¸ í™•ì¸ë¨! ì´ë™ ì¤‘...');
                    await new Promise(resolve => setTimeout(resolve, 500));
                    goToMainScreen(result.credits, result.key_name || '');
                } else {
                    // ë¡œê·¸ì¸ í•„ìš” - ë¡œê·¸ì¸ í¼ í‘œì‹œ
                    updateLoadingStatus(100, 'ì¤€ë¹„ ì™„ë£Œ!');
                    await new Promise(resolve => setTimeout(resolve, 300));
                    showLoginScreen();
                }
            } catch (e) {
                console.error('Init error:', e);
                updateLoadingStatus(100, 'ì¤€ë¹„ ì™„ë£Œ!');
                await new Promise(resolve => setTimeout(resolve, 300));
                showLoginScreen();
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        // Enter í‚¤ë¡œ ë¡œê·¸ì¸
        document.getElementById('apiKeyInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') login();
        });

        function toggleKeyVisibility() {
            isKeyVisible = !isKeyVisible;
            const input = document.getElementById('apiKeyInput');
            const eyeIcon = document.getElementById('eyeIcon');
            const eyeOffIcon = document.getElementById('eyeOffIcon');
            
            input.type = isKeyVisible ? 'text' : 'password';
            eyeIcon.style.display = isKeyVisible ? 'none' : 'block';
            eyeOffIcon.style.display = isKeyVisible ? 'block' : 'none';
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            errorText.textContent = message;
            errorEl.style.display = 'block';
        }

        function hideError() {
            document.getElementById('errorMessage').style.display = 'none';
        }

        function setLoading(loading) {
            const btn = document.getElementById('loginBtn');
            const icon = document.getElementById('loginBtnIcon');
            const text = document.getElementById('loginBtnText');
            const loadingEl = document.getElementById('loginBtnLoading');
            
            btn.disabled = loading;
            btn.style.opacity = loading ? '0.5' : '1';
            btn.style.cursor = loading ? 'not-allowed' : 'pointer';
            icon.style.display = loading ? 'none' : 'inline';
            text.textContent = loading ? 'ì—°ë™ ì¤‘...' : 'ì—°ë™í•˜ê¸°';
            loadingEl.style.display = loading ? 'block' : 'none';
        }

        async function login() {
            if (!pywebviewReady) {
                showError('ì•„ì§ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            
            hideError();
            
            if (!apiKey) {
                showError('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            if (!apiKey.startsWith('ap_')) {
                showError('ì˜¬ë°”ë¥¸ API í‚¤ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤ (ap_ë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤)');
                return;
            }
            
            setLoading(true);
            
            try {
                const result = await pywebview.api.login_with_api_key(apiKey);
                
                if (result.success) {
                    goToMainScreen(result.credits, result.key_name || '');
                } else {
                    showError(result.error || 'ì—°ë™ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }
            } catch (e) {
                showError('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + e);
            } finally {
                setLoading(false);
            }
        }
    </script>
</body>
</html>
